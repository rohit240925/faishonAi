import{s as l}from"./page-ai-fashion-generation-studio-wN5to6Tz.js";const v={async getPlans(){var t,r,o,i;try{const{data:s,error:e}=await((i=(o=(r=(t=l)==null?void 0:t.from("subscription_plans"))==null?void 0:r.select("*"))==null?void 0:o.eq("is_active",!0))==null?void 0:i.order("price_monthly",{ascending:!0}));if(e)throw e;return s||[]}catch(s){throw console.error("Get plans error:",s),s}},async getUserSubscription(t){var r,o,i,s,e;try{const{data:a,error:n}=await((e=(s=(i=(o=(r=l)==null?void 0:r.from("user_subscriptions"))==null?void 0:o.select("*,subscription_plans (*)"))==null?void 0:i.eq("user_id",t))==null?void 0:s.eq("status","active"))==null?void 0:e.single());if(n&&(n==null?void 0:n.code)!=="PGRST116")throw n;return a||null}catch(a){throw console.error("Get user subscription error:",a),a}},async createCheckoutSession(t,r="monthly"){var o,i,s,e;try{const{data:a,error:n}=await((e=(o=l)==null?void 0:o.functions)==null?void 0:e.invoke("create-checkout-session",{body:{planId:t,interval:r,successUrl:`${(i=window.location)==null?void 0:i.origin}/subscription/success`,cancelUrl:`${(s=window.location)==null?void 0:s.origin}/subscription`}}));if(n)throw n;return a}catch(a){throw console.error("Create checkout session error:",a),a}},async createPortalSession(){var t,r,o;try{const{data:i,error:s}=await((o=(t=l)==null?void 0:t.functions)==null?void 0:o.invoke("create-customer-portal",{body:{returnUrl:`${(r=window.location)==null?void 0:r.origin}/account`}}));if(s)throw s;return i}catch(i){throw console.error("Create portal session error:",i),i}},async purchaseCredits(t){var r,o,i,s,e;try{const{data:a,error:n}=await((r=l)==null?void 0:r.rpc("calculate_recharge_cost",{credits:t}));if(n)throw n;const{base_cost:c,discount_percent:u,final_cost:h}=a==null?void 0:a[0],{data:g,error:d}=await((e=(o=l)==null?void 0:o.functions)==null?void 0:e.invoke("create-checkout-session",{body:{type:"credit_recharge",credits:t,baseCost:c,discountPercent:u,finalCost:h,successUrl:`${(i=window.location)==null?void 0:i.origin}/credits/success`,cancelUrl:`${(s=window.location)==null?void 0:s.origin}/credits`}}));if(d)throw d;return g}catch(a){throw console.error("Purchase credits error:",a),a}},async getApiUsage(t,r=50){var o,i,s,e,a;try{const{data:n,error:c}=await((a=(e=(s=(i=(o=l)==null?void 0:o.from("api_usage"))==null?void 0:i.select(`
          *,
          user_subscriptions:subscription_id(
            plan_id,
            subscription_plans:plan_id(name)
          )
        `))==null?void 0:s.eq("user_id",t))==null?void 0:e.order("created_at",{ascending:!1}))==null?void 0:a.limit(r));if(c)throw c;return n||[]}catch(n){throw console.error("Error fetching API usage:",n),new Error("Failed to fetch API usage")}},async getBillingHistory(t,r=1,o=20){var i,s,e,a,n;try{const c=(r-1)*o,{data:u,error:h,count:g}=await((n=(a=(e=(s=(i=l)==null?void 0:i.from("billing_history"))==null?void 0:s.select("*",{count:"exact"}))==null?void 0:e.eq("user_id",t))==null?void 0:a.order("created_at",{ascending:!1}))==null?void 0:n.range(c,c+o-1));if(h)throw h;return{history:u||[],total:g||0,page:r,totalPages:Math.ceil((g||0)/o)}}catch(c){throw console.error("Get billing history error:",c),c}},async getFashionAnalysisResults(t,r=20){var o,i,s,e,a;try{const{data:n,error:c}=await((a=(e=(s=(i=(o=l)==null?void 0:o.from("fashion_analysis_results"))==null?void 0:i.select("*"))==null?void 0:s.eq("user_id",t))==null?void 0:e.order("created_at",{ascending:!1}))==null?void 0:a.limit(r));if(c)throw c;return n||[]}catch(n){throw console.error("Error fetching fashion analysis results:",n),new Error("Failed to fetch analysis results")}},async processAIGeneration({prompt:t,generationStyle:r="realistic",creativity:o=.7,maxImages:i=1}){var s,e,a,n;try{const{data:c,error:u}=await((e=(s=l)==null?void 0:s.auth)==null?void 0:e.getSession());if(u||!((a=c==null?void 0:c.session)!=null&&a.access_token))throw new Error("Authentication required");const h=await fetch("https://srdmnbcunaaxblvwgfbw.supabase.co/functions/v1/process-ai-generation",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${(n=c==null?void 0:c.session)==null?void 0:n.access_token}`},body:JSON.stringify({prompt:t,generationStyle:r,creativity:o,maxImages:i})}),g=await(h==null?void 0:h.json());if(!(h!=null&&h.ok))throw new Error(g.error||"Failed to process AI generation");return g}catch(c){throw console.error("Error processing AI generation:",c),c}},getStatusColor(t){const r={active:"text-green-600 bg-green-100",inactive:"text-gray-600 bg-gray-100",canceled:"text-red-600 bg-red-100",past_due:"text-yellow-600 bg-yellow-100",paused:"text-blue-600 bg-blue-100"};return(r==null?void 0:r[t])||(r==null?void 0:r.inactive)},async checkStorageUpgradeNeeded(t){var r,o,i,s;try{const{data:e,error:a}=await((s=(i=(o=(r=l)==null?void 0:r.from("user_profiles"))==null?void 0:o.select("storage_used_bytes, storage_limit_bytes"))==null?void 0:i.eq("id",t))==null?void 0:s.single());if(a)throw a;const n=(e==null?void 0:e.storage_used_bytes)/(e==null?void 0:e.storage_limit_bytes)*100;return{needsWarning:n>=90,usagePercent:Math.round(n),used:Math.round((e==null?void 0:e.storage_used_bytes)/(1024*1024)),limit:Math.round((e==null?void 0:e.storage_limit_bytes)/(1024*1024))}}catch(e){return console.error("Check storage upgrade error:",e),{needsWarning:!1,usagePercent:0}}},async sendNotificationEmail(t,r,o={}){var i,s;try{const{data:e,error:a}=await((s=(i=l)==null?void 0:i.functions)==null?void 0:s.invoke("send-notification-email",{body:{email:t,subject:this.getEmailSubject(r),template:r,data:o}}));if(a)throw a;return e}catch(e){throw console.error("Send notification email error:",e),e}},getEmailSubject(t){const r={welcome:"Welcome to FashionGen! ðŸŽ¨",subscription_changed:"Your FashionGen subscription has been updated",credit_recharge:"API credits successfully added to your account",storage_warning:"Storage limit warning - FashionGen"};return(r==null?void 0:r[t])||"FashionGen Notification"},calculatePrice(t,r="monthly"){return r==="yearly"?t*10:t},formatPrice(t,r="USD"){var o;return(o=new Intl.NumberFormat("en-US",{style:"currency",currency:r}))==null?void 0:o.format(t)},formatDate(t){var r;return t?(r=new Date(t))==null?void 0:r.toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"N/A"}},U={async generateFashionAnalysis(t,r={}){var o,i,s,e,a,n,c,u,h,g,d;try{const{styles:f=[],creativityLevel:w=.7,maxImages:y=1,inspirationImage:p=null,conversationalPrompt:m=""}=r,{data:_}=await((h=(u=(i=(o=l)==null?void 0:o.from("user_profiles"))==null?void 0:i.select("current_api_credits"))==null?void 0:u.eq("id",(c=(n=(a=await((e=(s=l)==null?void 0:s.auth)==null?void 0:e.getUser()))==null?void 0:a.data)==null?void 0:n.user)==null?void 0:c.id))==null?void 0:h.single());if(!_||(_==null?void 0:_.current_api_credits)<1)throw new Error("Insufficient API credits");const{data:S,error:b}=await((d=(g=l)==null?void 0:g.functions)==null?void 0:d.invoke("process-ai-generation",{body:{imageData:t,styles:f,creativityLevel:w,maxImages:y,inspirationImage:p,conversationalPrompt:m,operationType:"fashion_analysis"}}));if(b)throw b;return S}catch(f){throw console.error("Fashion analysis error:",f),f}},async getUserPortfolio(t,r=1,o=20){var i,s,e,a,n,c;try{const u=(r-1)*o,{data:h,error:g,count:d}=await((c=(n=(a=(e=(s=(i=l)==null?void 0:i.from("fashion_portfolio_images"))==null?void 0:s.select("*",{count:"exact"}))==null?void 0:e.eq("user_id",t))==null?void 0:a.eq("is_expired",!1))==null?void 0:n.order("created_at",{ascending:!1}))==null?void 0:c.range(u,u+o-1));if(g)throw g;return{images:h||[],total:d||0,page:r,totalPages:Math.ceil((d||0)/o)}}catch(u){throw console.error("Get portfolio error:",u),u}},async saveToPortfolio(t,r={}){var o,i,s,e,a,n,c,u,h,g;try{const d=await((i=(o=l)==null?void 0:o.auth)==null?void 0:i.getUser());if(!((s=d==null?void 0:d.data)!=null&&s.user))throw new Error("User not authenticated");const{data:f,error:w}=await((g=(h=(u=(e=l)==null?void 0:e.from("fashion_portfolio_images"))==null?void 0:u.insert({user_id:(n=(a=d==null?void 0:d.data)==null?void 0:a.user)==null?void 0:n.id,image_data:t,image_metadata:r,style:(r==null?void 0:r.style)||"realistic",original_prompt:(r==null?void 0:r.originalPrompt)||"",expires_at:(c=new Date(Date.now()+72*60*60*1e3))==null?void 0:c.toISOString()}))==null?void 0:h.select())==null?void 0:g.single());if(w)throw w;return f}catch(d){throw console.error("Save to portfolio error:",d),d}},async deleteFromPortfolio(t){var r,o,i;try{const{error:s}=await((i=(o=(r=l)==null?void 0:r.from("fashion_portfolio_images"))==null?void 0:o.delete())==null?void 0:i.eq("id",t));if(s)throw s;return!0}catch(s){throw console.error("Delete from portfolio error:",s),s}},async uploadInspirationImage(t,r){var o,i,s,e,a,n,c,u,h,g;try{const d=(i=(o=t==null?void 0:t.name)==null?void 0:o.split("."))==null?void 0:i.pop(),f=`${r}/inspiration/${Date.now()}.${d}`,w=await((s=l)==null?void 0:s.rpc("check_storage_limit",{user_uuid:r,file_size:t==null?void 0:t.size}));if(!(w!=null&&w.data))throw new Error("Storage limit exceeded. Please upgrade your plan or free up space.");const{data:y,error:p}=await((n=(a=(e=l)==null?void 0:e.storage)==null?void 0:a.from("fashion-images"))==null?void 0:n.upload(f,t,{cacheControl:"3600",upsert:!1}));if(p)throw p;await((c=l)==null?void 0:c.rpc("update_user_storage_usage",{user_uuid:r}));const{data:{publicUrl:m}}=(g=(h=(u=l)==null?void 0:u.storage)==null?void 0:h.from("fashion-images"))==null?void 0:g.getPublicUrl(f);return{path:y==null?void 0:y.path,url:m}}catch(d){throw console.error("Upload inspiration image error:",d),d}},async getUserStorageStats(t){var r,o,i,s;try{const{data:e,error:a}=await((s=(i=(o=(r=l)==null?void 0:r.from("user_profiles"))==null?void 0:o.select("storage_used_bytes, storage_limit_bytes"))==null?void 0:i.eq("id",t))==null?void 0:s.single());if(a)throw a;const n=Math.round((e==null?void 0:e.storage_used_bytes)/(1024*1024)),c=Math.round((e==null?void 0:e.storage_limit_bytes)/(1024*1024)),u=Math.round((e==null?void 0:e.storage_used_bytes)/(e==null?void 0:e.storage_limit_bytes)*100);return{used:n,limit:c,usagePercent:u,isNearLimit:u>=90}}catch(e){throw console.error("Get storage stats error:",e),e}},getAvailableStyles(){return[{id:"realistic",name:"Realistic",description:"Photorealistic fashion rendering"},{id:"artistic",name:"Artistic",description:"Creative and stylized interpretation"},{id:"vintage",name:"Vintage",description:"Classic retro fashion styles"},{id:"modern",name:"Modern",description:"Contemporary fashion trends"},{id:"casual",name:"Casual",description:"Everyday comfortable wear"},{id:"formal",name:"Formal",description:"Professional and elegant attire"},{id:"streetwear",name:"Streetwear",description:"Urban and edgy fashion"},{id:"bohemian",name:"Bohemian",description:"Free-spirited and artistic style"},{id:"minimalist",name:"Minimalist",description:"Clean and simple designs"},{id:"glamour",name:"Glamour",description:"Luxurious and sophisticated looks"}]},formatStorageSize(t){const r=["Bytes","KB","MB","GB"];if(t===0)return"0 Bytes";const o=Math.floor(Math.log(t)/Math.log(1024));return Math.round(t/Math.pow(1024,o)*100)/100+" "+(r==null?void 0:r[o])}};export{U as f,v as s};
//# sourceMappingURL=services-C3owMyCw.js.map
